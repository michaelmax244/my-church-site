<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>نظام حجز الكنيسة</title>
  <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* ===== المتغيرات الأساسية ===== */
    :root {
      --primary: #8e44ad;
      --primary-dark: #7d3c98;
      --secondary: #f39c12;
      --gold: #f1c40f;
      --white: #ffffff;
      --light: #f5f5f5;
      --dark: #2c3e50;
      --success: #27ae60;
      --error: #e74c3c;
      --border-radius: 10px;
      --shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    /* ===== الإعدادات العامة ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Scheherazade New', 'Cairo', sans-serif;
      background: linear-gradient(135deg, #f8f9fa, #e9ecef);
      min-height: 100vh;
      color: var(--dark);
      direction: rtl;
      line-height: 1.6;
    }

    h1, h2, h3 {
      font-family: 'Cairo', sans-serif;
      font-weight: 700;
    }

    /* ===== التصميم العام ===== */
    .header {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: var(--white);
      text-align: center;
      padding: 1.5rem;
      box-shadow: var(--shadow);
      position: relative;
    }

    .header::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(to right, var(--gold), var(--secondary));
    }

    .header h1 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .container {
      max-width: 600px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    /* ===== بطاقة النموذج ===== */
    .form-card {
      background-color: var(--white);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 2rem;
      position: relative;
      overflow: hidden;
    }

    .form-card::before {
      content: '✝';
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 2rem;
      color: rgba(142, 68, 173, 0.1);
      z-index: 0;
    }

    /* ===== حقول الإدخال ===== */
    .form-group {
      margin-bottom: 1.5rem;
      position: relative;
      z-index: 1;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 600;
      color: var(--primary-dark);
    }

    input, select {
      width: 100%;
      padding: 0.8rem 1rem;
      font-size: 1rem;
      border: 2px solid #ddd;
      border-radius: var(--border-radius);
      background-color: var(--light);
      transition: var(--transition);
      font-family: 'Scheherazade New', 'Cairo', sans-serif;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(142, 68, 173, 0.2);
    }

    input.valid, select.valid {
      border-color: var(--success);
      background-color: rgba(39, 174, 96, 0.05);
      padding-left: 3rem;
    }

    input.invalid, select.invalid {
      border-color: var(--error);
      background-color: rgba(231, 76, 60, 0.05);
      padding-left: 3rem;
    }

    /* ===== أيقونات الحالة ===== */
    .input-container {
      position: relative;
    }

    .status-icon {
      position: absolute;
      left: 1rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.2rem;
      pointer-events: none;
    }

    .valid + .status-icon::after {
      content: '✓';
      color: var(--success);
    }

    .invalid + .status-icon::after {
      content: '✕';
      color: var(--error);
    }

    /* ===== تواريخ الحجز ===== */
    .date-row {
      display: flex;
      gap: 1rem;
      margin-bottom: 1rem;
    }

    .date-row > div {
      flex: 1;
    }

    /* ===== زر الإرسال ===== */
    .submit-btn {
      display: block;
      width: 100%;
      padding: 1rem;
      background: linear-gradient(135deg, var(--secondary), var(--gold));
      color: var(--white);
      border: none;
      border-radius: var(--border-radius);
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--shadow);
      margin-top: 1.5rem;
      position: relative;
      overflow: hidden;
    }

    .submit-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
    }

    .submit-btn:active {
      transform: translateY(-1px);
    }

    .submit-btn::after {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: 0.5s;
    }

    .submit-btn:hover::after {
      left: 100%;
    }

    /* ===== العناصر المخفية ===== */
    .hidden {
      display: none;
    }

    /* ===== رسائل التغذية الراجعة ===== */
    .feedback {
      font-size: 0.85rem;
      margin-top: 0.5rem;
      padding: 0.5rem;
      border-radius: 5px;
    }

    .feedback.valid {
      color: var(--success);
      background-color: rgba(39, 174, 96, 0.1);
    }

    .feedback.invalid {
      color: var(--error);
      background-color: rgba(231, 76, 60, 0.1);
    }

    /* ===== التكيف مع الشاشات الصغيرة ===== */
    @media (max-width: 768px) {
      .container {
        padding: 0 1rem;
      }
      
      .form-card {
        padding: 1.5rem;
      }
      
      .date-row {
        flex-direction: column;
        gap: 0.5rem;
      }
    }
  </style>
</head>
<body>

<div class="header">
  <h1 id="church-title">نظام حجز الكنيسة</h1>
  <p>مكان للراحة الروحية والجسدية</p>
</div>

<div class="container">
  <div class="form-card">
    <!-- اسم الكاهن -->
    <div class="form-group input-container">
      <label for="priestName">اسم الكاهن</label>
      <input type="text" id="priestName" oninput="showPhone()" placeholder="أدخل اسم الكاهن">
      <span class="status-icon"></span>
    </div>

    <!-- رقم التليفون -->
    <div id="phoneDiv" class="form-group hidden input-container">
      <label for="phone">رقم التليفون</label>
      <input type="text" id="phone" oninput="showPeople()" placeholder="01XXXXXXXXX">
      <span class="status-icon"></span>
    </div>

    <!-- عدد الأفراد -->
    <div id="peopleDiv" class="form-group hidden input-container">
      <label for="peopleCount">عدد الأفراد</label>
      <input type="number" id="peopleCount" oninput="showDates()" min="1" max="1000" placeholder="عدد الأفراد">
      <span class="status-icon"></span>
    </div>

    <!-- مواعيد الحجز -->
    <div id="datesDiv" class="hidden">
      <label>موعد القدوم</label>
      <div class="date-row">
        <div class="input-container">
          <select id="arrivalMonth">
            <option disabled selected>اختر الشهر</option>
            <option value="1">يناير</option>
            <option value="2">فبراير</option>
            <option value="3">مارس</option>
            <option value="4">أبريل</option>
            <option value="5">مايو</option>
            <option value="6">يونيو</option>
            <option value="7">يوليو</option>
            <option value="8">أغسطس</option>
            <option value="9">سبتمبر</option>
            <option value="10">أكتوبر</option>
            <option value="11">نوفمبر</option>
            <option value="12">ديسمبر</option>
          </select>
          <span class="status-icon"></span>
        </div>
        <div class="input-container">
          <select id="arrivalDay">
            <option disabled selected>اختر اليوم</option>
            <option value="1">يوم 1</option>
            <option value="2">يوم 2</option>
            <option value="3">يوم 3</option>
            <option value="4">يوم 4</option>
            <option value="5">يوم 5</option>
            <option value="6">يوم 6</option>
            <option value="7">يوم 7</option>
            <option value="8">يوم 8</option>
            <option value="9">يوم 9</option>
            <option value="10">يوم 10</option>
            <option value="11">يوم 11</option>
            <option value="12">يوم 12</option>
            <option value="13">يوم 13</option>
            <option value="14">يوم 14</option>
            <option value="15">يوم 15</option>
            <option value="16">يوم 16</option>
            <option value="17">يوم 17</option>
            <option value="18">يوم 18</option>
            <option value="19">يوم 19</option>
            <option value="20">يوم 20</option>
            <option value="21">يوم 21</option>
            <option value="22">يوم 22</option>
            <option value="23">يوم 23</option>
            <option value="24">يوم 24</option>
            <option value="25">يوم 25</option>
            <option value="26">يوم 26</option>
            <option value="27">يوم 27</option>
            <option value="28">يوم 28</option>
            <option value="29">يوم 29</option>
            <option value="30">يوم 30</option>
          </select>
          <span class="status-icon"></span>
        </div>
      </div>

      <label>موعد المغادرة</label>
      <div class="date-row">
        <div class="input-container">
          <select id="leaveMonth">
            <option disabled selected>اختر الشهر</option>
            <option value="1">يناير</option>
            <option value="2">فبراير</option>
            <option value="3">مارس</option>
            <option value="4">أبريل</option>
            <option value="5">مايو</option>
            <option value="6">يونيو</option>
            <option value="7">يوليو</option>
            <option value="8">أغسطس</option>
            <option value="9">سبتمبر</option>
            <option value="10">أكتوبر</option>
            <option value="11">نوفمبر</option>
            <option value="12">ديسمبر</option>
          </select>
          <span class="status-icon"></span>
        </div>
        <div class="input-container">
          <select id="leaveDay">
            <option disabled selected>اختر اليوم</option>
            <option value="1">يوم 1</option>
            <option value="2">يوم 2</option>
            <option value="3">يوم 3</option>
            <option value="4">يوم 4</option>
            <option value="5">يوم 5</option>
            <option value="6">يوم 6</option>
            <option value="7">يوم 7</option>
            <option value="8">يوم 8</option>
            <option value="9">يوم 9</option>
            <option value="10">يوم 10</option>
            <option value="11">يوم 11</option>
            <option value="12">يوم 12</option>
            <option value="13">يوم 13</option>
            <option value="14">يوم 14</option>
            <option value="15">يوم 15</option>
            <option value="16">يوم 16</option>
            <option value="17">يوم 17</option>
            <option value="18">يوم 18</option>
            <option value="19">يوم 19</option>
            <option value="20">يوم 20</option>
            <option value="21">يوم 21</option>
            <option value="22">يوم 22</option>
            <option value="23">يوم 23</option>
            <option value="24">يوم 24</option>
            <option value="25">يوم 25</option>
            <option value="26">يوم 26</option>
            <option value="27">يوم 27</option>
            <option value="28">يوم 28</option>
            <option value="29">يوم 29</option>
            <option value="30">يوم 30</option>
          </select>
          <span class="status-icon"></span>
        </div>
      </div>
    </div>

    <button class="submit-btn" onclick="sendBooking()">إرسال الحجز</button>
  </div>
</div>

<script>
  // استرجاع الاسم من localStorage
  const churchName = localStorage.getItem("selectedChurch");
  document.getElementById("church-title").textContent = churchName ? `حجز زيارة ${churchName}` : "نظام حجز الكنيسة";

  // وظائف إظهار الحقول
  function showPhone() {
    const priestName = document.getElementById("priestName").value.trim();
    if (priestName !== "") {
      document.getElementById("phoneDiv").classList.remove("hidden");
    }
  }

  function showPeople() {
    const phone = document.getElementById("phone").value.trim();
    if (phone !== "") {
      document.getElementById("peopleDiv").classList.remove("hidden");
    }
  }

  function showDates() {
    const peopleCount = document.getElementById("peopleCount").value.trim();
    if (peopleCount !== "") {
      document.getElementById("datesDiv").classList.remove("hidden");
    }
  }

  // التحقق من صحة البيانات
  document.getElementById("priestName").addEventListener("blur", function() {
    if (this.value.trim() !== "") {
      this.classList.add("valid");
      this.classList.remove("invalid");
    } else {
      this.classList.add("invalid");
      this.classList.remove("valid");
    }
  });

  document.getElementById("phone").addEventListener("blur", function() {
    const phoneValue = this.value.trim();
    const isValid = /^01\d{9}$/.test(phoneValue);
    if (isValid) {
      this.classList.add("valid");
      this.classList.remove("invalid");
    } else {
      this.classList.add("invalid");
      this.classList.remove("valid");
    }
  });

  document.getElementById("peopleCount").addEventListener("blur", function() {
    const value = parseInt(this.value);
    if (!isNaN(value) && value > 0 && value <= 1000) {
      this.classList.add("valid");
      this.classList.remove("invalid");
    } else {
      this.classList.add("invalid");
      this.classList.remove("valid");
    }
  });

  // منع إدخال أكثر من 11 رقم للهاتف
  document.getElementById("phone").addEventListener("input", function() {
    if (this.value.length > 11) {
      this.value = this.value.slice(0, 11);
    }
  });

  // منع إدخال أكثر من 1000 فرد
  document.getElementById("peopleCount").addEventListener("input", function() {
    if (parseInt(this.value) > 1000) {
      this.value = 1000;
    }
  });
</script>

<script type="module">
  // استيراد الوظائف من Firebase
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";

  // إعداد Firebase الخاص بمشروعك
  const firebaseConfig = {
    apiKey: "AIzaSyCvoFHOUNYsvMbw4S5pkUG5aFJA-qfmICE",
    authDomain: "my-coptic-church-d55bb.firebaseapp.com",
    databaseURL: "https://my-coptic-church-d55bb-default-rtdb.firebaseio.com",
    projectId: "my-coptic-church-d55bb",
    storageBucket: "my-coptic-church-d55bb.appspot.com",
    messagingSenderId: "27856252983",
    appId: "1:27856252983:web:a385e6f1722f27c021cfb2",
    measurementId: "G-FLBQDF4VW9"
  };

  // تفعيل Firebase
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);

  // إرسال الحجز
  window.sendBooking = function() {
    const name = document.getElementById("priestName").value;
    const phone = document.getElementById("phone").value;
    const people = document.getElementById("peopleCount").value;
    const arrivalMonth = document.getElementById("arrivalMonth").value;
    const arrivalDay = document.getElementById("arrivalDay").value;
    const leaveMonth = document.getElementById("leaveMonth").value;
    const leaveDay = document.getElementById("leaveDay").value;
    const churchName = localStorage.getItem("selectedChurch") || "غير محددة";

    // التحقق من صحة جميع الحقول
    const isValid = (
      name.trim() !== "" &&
      /^01\d{9}$/.test(phone) &&
      !isNaN(people) && parseInt(people) > 0 &&
      arrivalMonth && arrivalDay &&
      leaveMonth && leaveDay
    );

    if (!isValid) {
      alert("من فضلك تأكد من صحة جميع البيانات المدخلة");
      return;
    }

    const bookingRef = ref(database, "bookings");
    const newBookingRef = push(bookingRef);

    set(newBookingRef, {
      church: churchName,
      name: name,
      phone: phone,
      people: parseInt(people),
      arrival: `${arrivalDay}-${arrivalMonth}`,
      leave: `${leaveDay}-${leaveMonth}`,
      timestamp: new Date().toISOString()
    }).then(() => {
      alert("تم إرسال الحجز بنجاح. شكراً لك!");
      window.location.href = "index.html";
    }).catch((error) => {
      alert("حدث خطأ أثناء إرسال الحجز: " + error.message);
    });
  };
</script>

</body>
</html>